<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Qucheng Jiang">

<title>Homework 4: Dominance – EECE7398 Fall 2024</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../blogs/Qucheng/2024-10-11-Qucheng-HW5.html" rel="next">
<link href="../../blogs/Qucheng/2024-10-11-Qucheng-HW3.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Homework 4: Dominance – EECE7398 Fall 2024">
<meta property="og:description" content="Homepage EECS7398 - Special Topic: Compilers, Fall 2024.">
<meta property="og:site_name" content="EECE7398 Fall 2024">
</head>

<body class="nav-sidebar docked fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../weekly.html">EECS 7398</a></li><li class="breadcrumb-item"><a href="../../blogs/09-20-2024-HW1-SanaTaghipourAnvari.html">Blogs</a></li><li class="breadcrumb-item"><a href="../../blogs/Qucheng/2024-09-20-Qucheng-HW1.html">Qucheng</a></li><li class="breadcrumb-item"><a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW4.html">Homework 4: Dominance</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">EECE7398 Fall 2024</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true">
 <span class="menu-text">EECS 7398</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weekly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weekly Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Class_Overview/What_to_do.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to submit assignments</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Blogs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/09-20-2024-HW1-SanaTaghipourAnvari.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework1 - Sana</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/junk_dir/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">sample blog with an image and a graph</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/junk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">sample blog</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Aymane</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/mlir-transform-dialect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Presentation - The MLIR Transform Dialect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 1 – Trying Out Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/readme2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 2 – Implementing DCE and LVN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/readme3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 3 – Implementing Liveness Dataflow Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/readme4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 4 – Implementing Dominance Algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/aymane/readme5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 5 – Implementing a simple LLVM pass</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Matin</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/matin/2024-09-20-HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/matin/2024-09-28-HW2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 2: Trivial Dead Code Elimination and Local Value Numbering Passes</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Michael</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/michael/09-20-2024-HW1-MichaelMaurer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EECE7309 Homework 1 – Trying Out Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/michael/09-27-2024-HW2-MichaelMaurer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EECE7309 Homework 2 – Local Optimizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/michael/10-11-2024-HW3-MichaelMaurer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EECE7309 Homework 3 – Data Flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/michael/10-18-2024-HW4-MichaelMaurer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EECE7309 Homework 4 – Dominance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/michael/11-01-2024-HW5-MichaelMaurer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EECE7309 Homework 5 – LLVM</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Oscar</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/oscar/2024-09-20-HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW1 - Trying Out Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/oscar/2024-09-27-HW2-Kellner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW2 - Minor Local Optimizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/oscar/2024-10-11-HW3-Kellner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW3 - Data Flow Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Qucheng</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Qucheng/2024-09-20-Qucheng-HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 1: Exploring Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Qucheng/2024-09-27-Qucheng-HW2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 2: Optimizing with DCE and LVN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 3: Data Flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Homework 4: Dominance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 5: LLVM - Spinning Up</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Rohit</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/rohit/2024-09-20-Rohit-HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/rohit/2024-09-28-Rohit-HW2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/rohit/2024-10-17-Rohit-HW3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/rohit/2024-10-18-Rohit-HW4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/rohit/2024-11-02-Rohit-HW5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 5</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">Sana</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Sana/09-27-2024-HW2-SanaTaghipourAnvari.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework2 - local optimizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Sana/10-11-2024-HW3-SanaTaghipourAnvari.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework3 - data flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Sana/10-18-2024-HW4-SanaTaghipourAnvari.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework4 - dominance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Sana/11-1-2024-HW5-SanaTaghipourAnvari.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework5 - LLVM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/Sana/PaperPresentation-LLMs-for-Compiler-Optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLMs for Code Optimization, A Promising Start or Overhyped Solution?</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">Sharmila</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/sharmila/2024-09-20-Sharmila-HW01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Homework 01 - Trying Out Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/sharmila/2024-09-27-Sharmila-HW02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Homework 02 - Local Optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/sharmila/2024-10-15-Sharmila-HW03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Homework 03 - Data Flow Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/sharmila/2024-10-18-Sharmila-HW04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Homework 04 - Implementing Dominance Utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/sharmila/2024-11-01-Sharmila-HW05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Homework 05 - LLVM Pass</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">Yashaswini</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/yashaswini/09-20-2024-HW1-YashaswiniMakaram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework1 - Yashaswini</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/yashaswini/09-27-2024-HW2-YashaswiniMakaram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework2 - Yashaswini</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/yashaswini/10-11-2024-HW3-YashaswiniMakaram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework3 - Yashaswini</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/yashaswini/10-18-2024-HW4-YashaswiniMakaram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework4 - Yashaswini</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blogs/yashaswini/11-1-2024-HW5-YashaswiniMakaram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework5 - Yashaswini</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">Homework</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/1.hw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 1 trying out bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/2_hw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 2 local optimizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/3_hw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 4 data flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/4_hw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">homework - dominance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/5_hw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 5 ssa</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/6_extra_credit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework 6 loop optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/dynamic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">homework 7 dynamic compile</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/hw0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">homework 0</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/hw5_llvm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">hw 5 llvm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">project</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/010_compiler_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compiler Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/01a_performance_measurement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance and Measurement</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/01a1_performance_measurement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance and Measurement part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/01a2_performance_measurement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance and Measurement part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/02a_representation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Representation of programs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/02b_bril.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of Bril</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03_local.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Local Analysis &amp; Optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/03b_local_value_numbering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">local value numbering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/04_data_flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/05_global.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Global Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/05b_licm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">loop invariant code motion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/05c_pre.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">_ partial_redundancy elimination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/06_ssa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static Single Assignment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/08_classic_loop_ops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 classic loop optimizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/09_poly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polyhedral Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/100_mlir.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 MLIR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/110_whole_program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Whole program</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/12_memory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Memory Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/13_dynamic_compilers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Compilers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/14_gpu_compilers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPU Compilers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/diverg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">divergent flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/diverg1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">divergent flow PART TWO</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/junk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/llvm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">using llvm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/mem_consistancy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">memory consistancy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/mlir.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polyhedral Compilation Opportunities in MLIR</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/poly_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction To Polyhedral Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ra-checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing Register allocators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/register_allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Register Allocation</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://capra.cs.cornell.edu/bril/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bril Documentation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/normrubin/bril" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bril github</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/normrubin/normrubin.github.io" class="sidebar-item-text sidebar-link">
 <span class="menu-text">class github</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../weekly.html">EECS 7398</a></li><li class="breadcrumb-item"><a href="../../blogs/09-20-2024-HW1-SanaTaghipourAnvari.html">Blogs</a></li><li class="breadcrumb-item"><a href="../../blogs/Qucheng/2024-09-20-Qucheng-HW1.html">Qucheng</a></li><li class="breadcrumb-item"><a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW4.html">Homework 4: Dominance</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Homework 4: Dominance</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Qucheng Jiang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="understanding-dominance-analysis-in-control-flow-graphs" class="level3">
<h3 class="anchored" data-anchor-id="understanding-dominance-analysis-in-control-flow-graphs">Understanding Dominance Analysis in Control Flow Graphs</h3>
<p>Dominance analysis is a fundamental concept in compiler optimization, crucial for understanding the structure of control flow within programs. It involves identifying dominance relationships among blocks in a Control Flow Graph (CFG), where a program is broken down into basic blocks connected by directed edges representing the possible flow of execution. This analysis is often used for advanced compiler optimizations like code motion, dead code elimination, and Static Single Assignment (SSA) form conversion.</p>
<p>This blog post delves into the key concepts of dominance analysis, including dominators, immediate dominators, and dominance frontiers. These concepts form the basis of various control flow optimizations and transformations.</p>
</section>
<section id="key-concepts" class="level3">
<h3 class="anchored" data-anchor-id="key-concepts">Key Concepts</h3>
<section id="dominators" class="level4">
<h4 class="anchored" data-anchor-id="dominators">Dominators</h4>
<p>In a CFG, a block <code>BB1</code> is said to dominate another block <code>BB2</code> if every path from the entry block to <code>BB2</code> must pass through <code>BB1</code> . The entry block itself trivially dominates all other blocks in the graph because all execution paths must originate from it.</p>
<p>The concept of dominators can be useful to identify regions in the program where specific code fragments will always execute before others. This information is essential for optimizations such as moving invariant computations out of loops and removing unreachable code.</p>
</section>
<section id="immediate-dominators" class="level4">
<h4 class="anchored" data-anchor-id="immediate-dominators">Immediate Dominators</h4>
<p>Among the set of blocks that dominate a particular block, the one closest to in terms of control flow is known as its <em>immediate dominator</em>. The immediate dominator is unique for each block (except the entry block) and forms the basis of the <em>dominator tree</em>, a hierarchical structure that reveals the dominance relationships within the CFG.</p>
<p>In the dominator tree, each node represents a basic block, and an edge from <code>BB1</code> to <code>BB2</code> indicates that <code>BB1</code> is the immediate dominator of <code>BB2</code> . This tree structure helps in visualizing the control dependencies in a program.</p>
</section>
<section id="dominance-frontier" class="level4">
<h4 class="anchored" data-anchor-id="dominance-frontier">Dominance Frontier</h4>
<p>The <em>dominance frontier</em> of a block <code>BB1</code> is the set of all blocks where the dominance relationship breaks. More formally, a block <code>BBX</code> is in the dominance frontier of <code>BB1</code> if <code>BB1</code> dominates a predecessor of <code>BBX</code> , but <code>BB1</code> does not strictly dominate <code>BBX</code> itself.</p>
<p>Dominance frontiers are used to identify the points in the CFG where variables need to be merged or “phi-inserted” during SSA form conversion. This is important because it ensures that all possible values of a variable reaching a certain block are correctly accounted for.</p>
</section>
</section>
<section id="control-flow-graph-and-dominance-analysis" class="level3">
<h3 class="anchored" data-anchor-id="control-flow-graph-and-dominance-analysis">Control Flow Graph and Dominance Analysis</h3>
<p>In the context of compiler design, the CFG represents the program’s execution paths, with nodes corresponding to basic blocks and edges denoting control flow between them. Dominance analysis provides a way to understand the flow of control within a program by identifying how execution paths interact and where they converge or diverge.</p>
<section id="the-role-of-dominators-in-cfg" class="level4">
<h4 class="anchored" data-anchor-id="the-role-of-dominators-in-cfg">The Role of Dominators in CFG</h4>
<p>Dominators can be seen as checkpoints that ensure certain computations always happen before others. For example, if a block <code>BB1</code> dominates <code>BB2</code> , we can be certain that the execution of <code>BB2</code> implies the execution of <code>BB1</code> at some point. This property allows for optimizations such as moving loop-invariant computations out of loops, as the computations are guaranteed to occur before each iteration of the loop.</p>
</section>
<section id="the-dominator-tree" class="level4">
<h4 class="anchored" data-anchor-id="the-dominator-tree">The Dominator Tree</h4>
<p>The dominator tree provides a structured way to represent the dominance relationships within the CFG. By identifying the immediate dominator for each block, we can construct a tree where each block is a child of its immediate dominator. This structure is useful for identifying regions of code that are tightly coupled in terms of control flow, aiding in optimizations such as code motion and dead code elimination.</p>
</section>
<section id="understanding-the-dominance-frontier" class="level4">
<h4 class="anchored" data-anchor-id="understanding-the-dominance-frontier">Understanding the Dominance Frontier</h4>
<p>The dominance frontier is particularly useful in scenarios where multiple control paths converge. It helps identify the blocks where different execution paths must be reconciled, especially in the context of SSA form, where variables may have different values depending on the path taken to reach a block. By inserting “phi functions” at the dominance frontier, the compiler can correctly handle the merging of variable values from different paths.</p>
</section>
</section>
</section>
<section id="detail-design" class="level2">
<h2 class="anchored" data-anchor-id="detail-design">Detail Design</h2>
<section id="abstraction-classes" class="level3">
<h3 class="anchored" data-anchor-id="abstraction-classes">Abstraction Classes</h3>
<p>The abstraction class remain the same structure as last homework submittion, see detail in <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/tree/main/HW3#abstraction-classes">HW3 - Abstraction Classes</a>.</p>
<p>I add one additional feature: <code>__lt__()</code> for class <code>BrilInstruction_Label</code>, therefore use current <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/tree/main/HW4/bril_model"><code>./bril_model</code></a> for further development.</p>
</section>
<section id="dominance-analysis-implementation" class="level3">
<h3 class="anchored" data-anchor-id="dominance-analysis-implementation">Dominance Analysis Implementation</h3>
<p>The script <code>dom_analysis.py</code> is designed to perform dominance analysis on Bril program. It includes functionalities for generating a Control Flow Graph (CFG), computing dominators for each block, constructing the dominator tree, and identifying the dominance frontier. Below is a breakdown of the key parts of the code with brief notes on their functions and corresponding source code line indxx.</p>
<section id="imports-and-argument-parsing" class="level4">
<h4 class="anchored" data-anchor-id="imports-and-argument-parsing">1. <strong>Imports and Argument Parsing</strong></h4>
<ul>
<li>The code imports necessary libraries like <code>os</code>, <code>networkx</code>, <code>pyvis</code>, and <code>matplotlib</code> for graph visualization, as well as custom modules from <code>bril_model</code>.</li>
<li>It also sets up argument parsing to allow the user to specify the Bril file to analyze and an optional save directory for generated outputs.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L1-L46">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># %% [markdown] </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># # Playground - data flow graph  </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># %% </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> os </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> networkx <span class="im">as</span> nx </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> pyvis <span class="im">as</span> pv </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> graphviz <span class="im">as</span> gv </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="im">from</span> typing <span class="im">import</span> Iterable, Tuple, Set, List, Dict, OrderedDict, Optional </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> bril_model <span class="im">as</span> bm </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="im">from</span> bril_model.form_blocks <span class="im">import</span> form_blocks </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> <span class="im">from</span> hashlib <span class="im">import</span> sha256 </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> fast_hash <span class="op">=</span> <span class="kw">lambda</span> <span class="bu">str</span>: sha256(<span class="bu">str</span>).hexdigest()[:<span class="dv">3</span>] </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># usage: &lt;this_script&gt; DEMO_BRIL_FILE [--save-dir=./save | --mute-output]  </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> <span class="im">import</span> argparse </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> parser <span class="op">=</span> argparse.ArgumentParser(description<span class="op">=</span><span class="st">'Generate CFG with dominance frontier and Dominator-Tree for a bril script'</span>) </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a> parser.add_argument(<span class="st">'DEMO_BRIL_FILE'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to the bril file'</span>) </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> parser.add_argument(<span class="st">'--save-dir'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, default<span class="op">=</span><span class="st">'./save'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to save the generated html files'</span>) </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a> parser.add_argument(<span class="st">'--mute-output'</span>, action<span class="op">=</span><span class="st">'store_true'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Mute the output of the graphviz render'</span>, default<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a> args <span class="op">=</span> parser.parse_args() </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> DEMO_BRIL_FILE <span class="op">=</span> args.DEMO_BRIL_FILE </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> SAVE_DIR <span class="op">=</span> args.save_dir </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a> MUTE_OUTPUT <span class="op">=</span> args.mute_output </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> <span class="co"># DEMO_BRIL_FILE = "../bril/examples/test/dom/loopcond.bril" </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># DEMO_BRIL_FILE = "../bril/examples/test/dom/while.bril" </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> <span class="co"># %% </span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> <span class="co"># make sure args are allowed </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a> args_correct <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="kw">not</span> os.path.exists(DEMO_BRIL_FILE): </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="ss">f"File &lt;</span><span class="sc">{</span>DEMO_BRIL_FILE<span class="sc">}</span><span class="ss">&gt; not found"</span>) </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>     args_correct <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="kw">not</span> args_correct: </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>     <span class="co"># print help and exit </span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>     parser.print_help() </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>     exit(<span class="dv">1</span>) </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a> <span class="co"># %% </span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a> ENTRY_POINT_NAME <span class="op">=</span> <span class="st">'ENTRY'</span> </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a> RETURN_POINT_NAME <span class="op">=</span> <span class="st">'RETURN'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="basic-block-definition" class="level4">
<h4 class="anchored" data-anchor-id="basic-block-definition">2. <strong>Basic Block Definition</strong></h4>
<ul>
<li>This section defines the <code>BasicBlock</code> class, representing a basic block in the CFG. Each basic block consists of a label and a list of instructions.</li>
<li>It also includes properties for successors (<code>succ</code>) and predecessors (<code>pred</code>), which form the edges in the CFG.</li>
<li>The class implements various methods for equality checks, hashing, and string representation.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L48-L86">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">class</span> BasicBlock(): </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, label: bm.BrilInstruction_Label, instrs: List[bm.BrilInstruction]): </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(label, bm.BrilInstruction_Label): </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>             <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f"Expected label, got </span><span class="sc">{</span><span class="bu">type</span>(label)<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> label <span class="kw">not</span> <span class="kw">in</span> instrs: </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>             instrs.insert(<span class="dv">0</span>, label) </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.instrs <span class="op">=</span> instrs </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.succ: Set[BasicBlock] <span class="op">=</span> <span class="bu">set</span>() </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="va">self</span>.pred: Set[BasicBlock] <span class="op">=</span> <span class="bu">set</span>() </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">@property</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> label(<span class="va">self</span>): </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="va">self</span>.instrs[<span class="dv">0</span>] </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>: </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.label) </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, o: <span class="bu">object</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>: </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(o, BasicBlock): </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> <span class="va">False</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="va">self</span>.label <span class="op">==</span> o.label </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__lt__</span>(<span class="va">self</span>, o: <span class="bu">object</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>: </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(o, BasicBlock): </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> <span class="va">False</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>         <span class="co"># return block is always the last one </span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="va">self</span>.label.label <span class="op">==</span> RETURN_POINT_NAME: <span class="cf">return</span> <span class="va">False</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> o.label.label <span class="op">==</span> RETURN_POINT_NAME: <span class="cf">return</span> <span class="va">True</span> </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>         <span class="co"># entry block is always the first one </span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="va">self</span>.label.label <span class="op">==</span> ENTRY_POINT_NAME: <span class="cf">return</span> <span class="va">True</span> </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> o.label.label <span class="op">==</span> ENTRY_POINT_NAME: <span class="cf">return</span> <span class="va">False</span> </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="va">self</span>.label <span class="op">&lt;</span> o.label </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>): </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="va">self</span>.label.label <span class="kw">in</span> {ENTRY_POINT_NAME, RETURN_POINT_NAME}: <span class="cf">return</span> <span class="va">self</span>.label.label </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>         _instrs <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">  '</span>.join([x.to_briltxt() <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.instrs[<span class="dv">1</span>:]]) </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> _instrs: </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>             _instrs <span class="op">=</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">  </span><span class="sc">{</span>_instrs<span class="sc">}</span><span class="ss">"</span> </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>label<span class="sc">.</span>to_briltxt()<span class="sc">}{</span>_instrs<span class="sc">}</span><span class="ss">"</span> </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>     <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>): </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> :: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>label<span class="sc">.</span>to_briltxt()<span class="sc">}</span><span class="ss">..[</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.instrs) <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">]"</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="forming-basic-blocks-from-bril-functions" class="level4">
<h4 class="anchored" data-anchor-id="forming-basic-blocks-from-bril-functions">3. <strong>Forming Basic Blocks from Bril Functions</strong></h4>
<ul>
<li>The function <code>iter_func_blocks</code> generates basic blocks from the provided Bril script by iterating over each function in the script and forming blocks based on instruction labels.</li>
<li>For functions without explicit labels, it creates anonymous basic blocks.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L89-L101">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> iter_func_blocks(bs: bm.BrilScript) <span class="op">-&gt;</span> Iterable[Tuple[bm.BrilFunction, List[BasicBlock]]]: </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> each_func <span class="kw">in</span> bs.functions: </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         bbs: List[BasicBlock] <span class="op">=</span> <span class="bu">list</span>() </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         anonymous_id <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> each_block <span class="kw">in</span> form_blocks(each_func.instrs): </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>             this_block_label: bm.BrilInstruction_Label <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> <span class="bu">isinstance</span>(each_block[<span class="dv">0</span>], bm.BrilInstruction_Label): </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                 this_block_label <span class="op">=</span> each_block[<span class="dv">0</span>] </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>             <span class="cf">else</span>: </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                 this_block_label <span class="op">=</span> bm.BrilInstruction_Label(<span class="bu">dict</span>(label<span class="op">=</span><span class="st">'_f</span><span class="sc">{}</span><span class="st">._anon</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(fast_hash(each_func.name.encode()), anonymous_id))) </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                 anonymous_id <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>             bbs.append(BasicBlock(this_block_label, each_block)) </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         <span class="cf">yield</span> (each_func, bbs) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="generating-the-cfg" class="level4">
<h4 class="anchored" data-anchor-id="generating-the-cfg">4. <strong>Generating the CFG</strong></h4>
<ul>
<li>The <code>generate_func_cfg_dict</code> function builds the CFG by establishing the control flow between basic blocks. It adds <code>entry</code> and <code>return</code> blocks to represent the start and end points of a function.</li>
<li>It iterates over the blocks and updates the predecessors and successors based on control flow instructions (<code>jmp</code>, <code>br</code>, <code>ret</code>).</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L103-L156">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> generate_func_cfg_dict(bscript: bm.BrilScript) <span class="op">-&gt;</span> Dict[bm.BrilFunction, List[BasicBlock]]: </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>     app_bbs_dict: OrderedDict[bm.BrilFunction, List[BasicBlock]] <span class="op">=</span> {} </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> each_func, basic_blocks <span class="kw">in</span> iter_func_blocks(bscript): </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># print("Function: {}".format(each_func.name)) </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         entry_bb <span class="op">=</span> BasicBlock(bm.BrilInstruction_Label(<span class="bu">dict</span>(label<span class="op">=</span>ENTRY_POINT_NAME)), []) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         return_bb <span class="op">=</span> BasicBlock(bm.BrilInstruction_Label(<span class="bu">dict</span>(label<span class="op">=</span>RETURN_POINT_NAME)), []) </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         prev_bb: Optional[BasicBlock] <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         is_first: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> each_bb <span class="kw">in</span> basic_blocks: </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> prev_bb: </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># reason: fallthrough edge </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                 prev_bb.succ.add(each_bb) </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                 each_bb.pred.add(prev_bb) </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>             <span class="cf">elif</span> is_first: </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># reason: entry edge </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                 entry_bb.succ.add(each_bb) </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                 each_bb.pred.add(entry_bb) </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                 is_first <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>             <span class="co"># get last instruction if exists </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>             final_instr <span class="op">=</span> each_bb.instrs[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> each_bb.instrs <span class="cf">else</span> <span class="va">None</span> </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> final_instr <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># empty block, skip </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                 prev_bb <span class="op">=</span> each_bb </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>             <span class="cf">elif</span> final_instr.op <span class="kw">in</span> [<span class="st">'jmp'</span>, <span class="st">'br'</span>]: </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># reaching control flow instruction </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span> redirect_instr_to_bb_label <span class="kw">in</span> final_instr.labels: </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                     next_bb <span class="op">=</span> <span class="bu">next</span>((bb <span class="cf">for</span> bb <span class="kw">in</span> basic_blocks <span class="cf">if</span> bb.label.label <span class="op">==</span> redirect_instr_to_bb_label), <span class="va">None</span>) </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> next_bb <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Cannot find block with label </span><span class="sc">{</span>redirect_instr_to_bb_label<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># reason: control flow edge </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                     each_bb.succ.add(next_bb) </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                     next_bb.pred.add(each_bb) </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                 prev_bb <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>             <span class="cf">elif</span> final_instr.op <span class="kw">in</span> [<span class="st">'ret'</span>]: </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># reaching return instruction </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># reason: return edge </span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                 each_bb.succ.add(return_bb) </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                 return_bb.pred.add(each_bb) </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>                 prev_bb <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># explicit return block, no fallthrough </span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>             <span class="cf">else</span>: </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># normal instruction, prepare for fallthrough </span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                 prev_bb <span class="op">=</span> each_bb </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>         <span class="co"># check if last block has no fallthrough </span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> prev_bb: </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>             <span class="co"># reason: return edge </span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>             prev_bb.succ.add(return_bb) </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>             return_bb.pred.add(prev_bb) </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>         <span class="co"># add entry/return block </span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>         basic_blocks.insert(<span class="dv">0</span>, entry_bb) </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>         basic_blocks.append(return_bb) </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>         app_bbs_dict[each_func] <span class="op">=</span> basic_blocks </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> app_bbs_dict </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="computing-dominators" class="level4">
<h4 class="anchored" data-anchor-id="computing-dominators">5. <strong>Computing Dominators</strong></h4>
<ul>
<li>The <code>generate_dom_dict</code> function calculates the dominators for each block using an iterative fixed-point algorithm.</li>
<li>Initially, every block is assumed to dominate itself and all others. The algorithm repeatedly refines the dominator sets by intersecting the dominator sets of each block’s predecessors.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L162-L183">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> generate_dom_dict(bbs: List[BasicBlock]) <span class="op">-&gt;</span> <span class="bu">dict</span>[BasicBlock, <span class="bu">set</span>[BasicBlock]]: </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Initialize dominator sets for each block </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Initially, every block dominates every other block </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>     dom: Dict[BasicBlock, Set[BasicBlock]] <span class="op">=</span> {bb: <span class="bu">set</span>(bbs) <span class="cf">for</span> bb <span class="kw">in</span> bbs} </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>     <span class="co"># The entry block only dominates itself </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     bb_entry <span class="op">=</span> getBasicBlockByLabel(bbs, ENTRY_POINT_NAME) </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     dom[bb_entry] <span class="op">=</span> <span class="bu">set</span>([bb_entry]) </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>     changed: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>     <span class="cf">while</span> changed: </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>         changed <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> each_bb <span class="kw">in</span> bbs: </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> each_bb <span class="op">==</span> bb_entry: <span class="cf">continue</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>             <span class="co"># The dominator set of a bb is the intersection of the dominator sets of its predecessors </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>             this_bb_dom <span class="op">=</span> <span class="bu">set</span>.intersection(<span class="op">*</span>[dom[each_pred] <span class="cf">for</span> each_pred <span class="kw">in</span> each_bb.pred] <span class="kw">or</span> [<span class="bu">set</span>()]) </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>             <span class="co"># The dominator set of a bb should includes itself </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>             this_bb_dom.add(each_bb) </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>             <span class="co"># Update if changed </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> dom[each_bb] <span class="op">!=</span> this_bb_dom: </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                 dom[each_bb] <span class="op">=</span> this_bb_dom </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                 changed <span class="op">=</span> <span class="va">True</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> dom </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="immediate-dominator-calculation" class="level4">
<h4 class="anchored" data-anchor-id="immediate-dominator-calculation">6. <strong>Immediate Dominator Calculation</strong></h4>
<ul>
<li>The <code>get_lease_superset_dom</code> function identifies the immediate dominator for a given block by finding the closest dominator in the dominator set.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L185-L187">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># get the last dom of a given block </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> get_lease_superset_dom(dom_dict: <span class="bu">dict</span>[BasicBlock, <span class="bu">set</span>[BasicBlock]], bb: BasicBlock) <span class="op">-&gt;</span> Optional[BasicBlock]: </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> <span class="bu">next</span>((test_dom <span class="cf">for</span> test_dom <span class="kw">in</span> dom_dict[bb] <span class="cf">if</span> ((dom_dict[bb] <span class="op">-</span> dom_dict[test_dom]) <span class="op">==</span> <span class="bu">set</span>([bb]))), <span class="va">None</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="dominance-frontier-computation" class="level4">
<h4 class="anchored" data-anchor-id="dominance-frontier-computation">7. <strong>Dominance Frontier Computation</strong></h4>
<ul>
<li>The <code>get_dom_frontier</code> function determines the dominance frontier for a given block. It checks blocks where the dominance relationship changes based on control flow.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L189-L191">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># get the dom frontiers of a given block. (One-liner version, the well-commented version is hidden in previous commits) </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> get_dom_frontier(dom: Dict[BasicBlock, Set[BasicBlock]], bb: BasicBlock) <span class="op">-&gt;</span> Set[BasicBlock]: </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> <span class="bu">set</span>([test_with_bb <span class="cf">for</span> test_with_bb <span class="kw">in</span> dom.keys() <span class="cf">if</span> (bb <span class="kw">not</span> <span class="kw">in</span> dom[test_with_bb] <span class="kw">or</span> bb <span class="op">==</span> test_with_bb) <span class="kw">and</span> (bb <span class="kw">in</span> <span class="bu">set</span>.union(<span class="op">*</span>[dom[each_tbp] <span class="cf">for</span> each_tbp <span class="kw">in</span> test_with_bb.pred] <span class="kw">or</span> [<span class="bu">set</span>()]))]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="graph-visualization" class="level4">
<h4 class="anchored" data-anchor-id="graph-visualization">8. <strong>Graph Visualization</strong></h4>
<ul>
<li>The code includes helper functions for generating graph visualizations using <code>Graphviz</code>. The functions <code>create_graphviz_dot_node</code> and <code>create_graphviz_dot_edge</code> create nodes and edges for the CFG and dominator tree graphs.</li>
<li>The <code>create_graphviz_dot</code> function produces separate visualizations for the CFG and dominator tree.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L211-L258">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> create_graphviz_dot(app_graph: Dict[bm.BrilFunction, List[BasicBlock]]) <span class="op">-&gt;</span> Tuple[gv.Digraph, gv.Digraph]: </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>     dot_cfg <span class="op">=</span> gv.Digraph(<span class="st">'CFG'</span>, comment<span class="op">=</span><span class="st">'Control Flow Graph'</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     dot_domt <span class="op">=</span> gv.Digraph(<span class="st">'DOMTREE'</span>, comment<span class="op">=</span><span class="st">'Dominator Tree'</span>) </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> each_func, bbs <span class="kw">in</span> app_graph.items(): </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         _func_show_str <span class="op">=</span> <span class="bu">str</span>(each_func).replace(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, <span class="st">'  '</span>) </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f" </span><span class="sc">{</span>_func_show_str<span class="sc">}</span><span class="ss"> "</span>.center(<span class="dv">80</span>, <span class="st">'='</span>)) </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>         dom <span class="op">=</span> generate_dom_dict(bbs) </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>         _max_bb_label_len <span class="op">=</span> <span class="bu">max</span>([<span class="bu">len</span>(bb.label.label) <span class="cf">for</span> bb <span class="kw">in</span> bbs]) </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>         <span class="co"># each func is a subgraph </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="cf">with</span> dot_cfg.subgraph(name<span class="op">=</span><span class="ss">f"cluster_</span><span class="sc">{</span>each_func<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>) <span class="im">as</span> dot_cfg_func, dot_domt.subgraph(name<span class="op">=</span><span class="ss">f"cluster_</span><span class="sc">{</span>each_func<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>) <span class="im">as</span> dot_domt_func: </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>             dot_cfg_func.attr(label<span class="op">=</span>each_func.name) </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>             dot_cfg_func.attr(color<span class="op">=</span><span class="st">'#f7f7f7'</span>) </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>             dot_cfg_func.attr(style<span class="op">=</span><span class="st">'filled'</span>) </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>             dot_cfg_func.attr(rankdir<span class="op">=</span><span class="st">'TB'</span>) </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>             dot_domt_func.attr(label<span class="op">=</span>each_func.name) </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>             dot_domt_func.attr(color<span class="op">=</span><span class="st">'#f7f7f7'</span>) </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>             dot_domt_func.attr(style<span class="op">=</span><span class="st">'filled'</span>) </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>             dot_domt_func.attr(rankdir<span class="op">=</span><span class="st">'TB'</span>) </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="st">" Dom-Front "</span>.center(<span class="dv">80</span>, <span class="st">'-'</span>)) </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>             <span class="co"># generate cfg dot graph </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> each_bb <span class="kw">in</span> bbs: </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                 dom_frontiers <span class="op">=</span> get_dom_frontier(dom, each_bb) </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>each_bb<span class="sc">.</span>label<span class="sc">.</span>label<span class="sc">.</span>ljust(_max_bb_label_len)<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join([x.label.label <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">sorted</span>(dom_frontiers)])<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                 create_graphviz_dot_node(dot_cfg_func, each_func, each_bb) </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span> each_df <span class="kw">in</span> dom_frontiers: </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                     create_graphviz_dot_edge(dot_cfg_func, each_func, each_bb, each_df, style<span class="op">=</span><span class="st">'dashed'</span>, color<span class="op">=</span><span class="st">'#66ccff'</span>, label<span class="op">=</span><span class="st">'DF'</span>, fontsize<span class="op">=</span><span class="st">'10'</span>, fontcolor<span class="op">=</span><span class="st">'#66ccff'</span>, constraint<span class="op">=</span><span class="st">'false'</span>) </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span> each_succ <span class="kw">in</span> each_bb.succ: </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                     create_graphviz_dot_edge(dot_cfg_func, each_func, each_bb, each_succ) </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>             <span class="co"># generate domt dot graph </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="st">" Dom &amp; Dom-Tree "</span>.center(<span class="dv">80</span>, <span class="st">'-'</span>)) </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> each_bb <span class="kw">in</span> dom.keys(): </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                 least_superset_dom <span class="op">=</span> get_lease_superset_dom(dom, each_bb) </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>each_bb<span class="sc">.</span>label<span class="sc">.</span>label<span class="sc">.</span>ljust(_max_bb_label_len)<span class="sc">}</span><span class="ss"> &lt;- </span><span class="sc">{</span>(least_superset_dom.label.label <span class="cf">if</span> least_superset_dom <span class="cf">else</span> <span class="st">'[ROOT]'</span>)<span class="sc">.</span>ljust(_max_bb_label_len)<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join([x.label.label <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">sorted</span>(dom[each_bb])])<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                 create_graphviz_dot_node(dot_domt_func, each_func, each_bb) </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span> least_superset_dom: </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                     create_graphviz_dot_edge(dot_domt_func, each_func, least_superset_dom, each_bb) </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>             <span class="co"># print the script in briltxt format for reference </span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="st">" Script "</span>.center(<span class="dv">80</span>, <span class="st">'-'</span>)) </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> each_bb <span class="kw">in</span> bbs: </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span> each_instr <span class="kw">in</span> each_bb.instrs: </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                     <span class="bu">print</span>( (<span class="st">""</span> <span class="cf">if</span> <span class="bu">isinstance</span>(each_instr, bm.BrilInstruction_Label) <span class="cf">else</span> <span class="st">"  "</span>) <span class="op">+</span> each_instr.to_briltxt()) </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>() </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> dot_cfg, dot_domt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="main-execution" class="level4">
<h4 class="anchored" data-anchor-id="main-execution">9. <strong>Main Execution</strong></h4>
<ul>
<li>The script loads the specified Bril file and constructs the CFG for the functions in the script.</li>
<li>It then generates the dot files for the CFG and dominator tree, saving them in the specified directory.</li>
</ul>
<details>
<summary>
ℹ️ View source code : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/dom_analysis.py#L261-L281">EECE7398_ST_Compiler/HW4/dom_analysis.py @ 582ec4a</a>.
</summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># %% </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># load the bril script </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> bscript <span class="op">=</span> bm.BrilScript(script_name<span class="op">=</span>os.path.basename(DEMO_BRIL_FILE), file_dir<span class="op">=</span>os.path.dirname(DEMO_BRIL_FILE)) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>(bscript) </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a> app_graph: Dict[bm.BrilFunction, List[BasicBlock]] <span class="op">=</span> generate_func_cfg_dict(bscript) </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># print("Functions: {}".format(', '.join([f"[{idx}]={x.name}" for idx, x in enumerate(app_graph.keys())]))) </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>() </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> dot_cfg, dot_domt <span class="op">=</span> create_graphviz_dot(app_graph) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> MUTE_OUTPUT: </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>     exit(<span class="dv">0</span>) </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Finally, create the save directory if not exists, and save the generated dot files </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="kw">not</span> os.path.exists(SAVE_DIR): </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>     os.makedirs(SAVE_DIR) </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a> _gv_ret <span class="op">=</span> dot_cfg.render(os.path.join(SAVE_DIR, bscript.script_name<span class="op">+</span><span class="st">".cfg.gv"</span>), view<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>(_gv_ret) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a> _gv_ret <span class="op">=</span> dot_domt.render(os.path.join(SAVE_DIR, bscript.script_name<span class="op">+</span><span class="st">".domt.gv"</span>), view<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a> <span class="bu">print</span>(_gv_ret) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
</section>
<section id="integration-and-testing" class="level3">
<h3 class="anchored" data-anchor-id="integration-and-testing">Integration and Testing</h3>
<p>The integration and testing phase focuses on verifying the correctness of the dominance analysis by evaluating its results against various test cases. The goal is to ensure that the dominance rules defined in the dominator tree are upheld for different basic block execution paths. This involves checking if any execution sequence violates the dominance relationships established by the analysis. To achieve this, the following steps are used:</p>
<ol type="1">
<li><strong>General Testing Approach</strong>:
<ul>
<li>The basic and general idea of verification is to <strong>iterate over all possible paths of execution</strong> in the Control Flow Graph (CFG) and validate the dominance properties. Specifically, we ensure that if block <code>BB1</code> dominates block <code>BB2</code>, then any execution path reaching <code>BB2</code> must pass through <code>BB1</code>.</li>
<li>For each basic block, we confirm that its set of dominators conforms to the expectations as derived from the dominator tree.</li>
<li>The results are compared against reference outputs from well-understood examples discussed in class, as well as other edge cases designed to stress test the analysis.</li>
<li>All analysis output are checked manually, and stored as the <strong>golden snapshot using <code>turnt</code> toolchain</strong>. To test any modification, use command <code>make turnt</code> to submit a fast check if anything have changed.</li>
</ul></li>
<li><strong>Test Cases</strong>:
<ul>
<li>To thoroughly validate the implementation, several test cases in <code>.bril</code> format are used, which cover a variety of CFG structures. These include:
<ul>
<li><strong>Branching and Merging</strong>: Simple branches where different paths converge into a single block. This tests if the dominance frontier is correctly identified.</li>
<li><strong>Loop Structures</strong>:
<ul>
<li><strong>Natural Loops</strong>: A basic loop where the execution repeatedly returns to the entry point. This checks if the analysis can handle back edges correctly.</li>
<li><strong>Cross Loops</strong>: Where multiple loops share a common point, testing the algorithm’s handling of intertwined control flows.</li>
<li><strong>Self-Loops</strong>: Where a block jumps to itself, testing the edge case of dominance with cyclic behavior.</li>
</ul></li>
<li><strong>Complex Branches</strong>: Multi-level branching scenarios that test cascading decision-making processes.</li>
<li><strong>Select Cases with Fallthrough</strong>: A switch-like structure where control can fall through to subsequent cases, testing non-trivial flow paths.</li>
<li><strong>Cycle with/without Header</strong>: Examining cases where cycles may or may not have a designated entry block, testing the analysis of entry points and loop headers.</li>
<li><strong>Multiple Entry Points</strong>: CFGs with more than one entry point, challenging the assumptions about where execution begins.</li>
</ul></li>
</ul></li>
<li><strong>Testing Execution</strong>:
<ul>
<li>Each test case is analyzed using the implemented dominance utilities, and the results are compared against expected outputs derived manually or from reference solutions provided in class.</li>
<li>The verification process involves:
<ol type="1">
<li><strong>Dominators Check</strong>: Ensuring that for each block <code>BB1</code>, its dominator set only contains blocks that dominate <code>BB1</code> as per the expected results.</li>
<li><strong>Immediate Dominators Check</strong>: Validating the immediate dominator for each block against the reference dominator tree structure.</li>
<li><strong>Dominance Frontier Check</strong>: Confirming that the dominance frontier of each block matches the expected set of blocks where the dominance relationship changes.</li>
</ol></li>
</ul></li>
</ol>
</section>
<section id="results-and-analysis" class="level3">
<h3 class="anchored" data-anchor-id="results-and-analysis">Results and Analysis</h3>
<p>👉 Check <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/tree/main/HW4/output">HERE</a> to see all graphical testcase results.</p>
<p>The analysis results demonstrate the correctness and robustness of the dominance utilities. The generated dominance information (dominator sets, dominator tree, and dominance frontier) matches the expected results for all test cases. Below is a summary of the findings:</p>
<ol type="1">
<li><strong>Branching and Merging</strong>:
<ul>
<li>The dominance analysis correctly identifies the blocks that dominate each branch and accurately determines the dominance frontiers where paths converge. <img src="./2024-10-11-Qucheng-HW4.image-1.png" class="img-fluid" alt="image"></li>
</ul></li>
</ol>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_dom/Natural-Loops.golden-log#L1-L40">Natural-Loops.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  Natural-Loops.bril &lt;1 func&gt; @ example/in_class_example_dom 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;14 instr&gt; ================ 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY  :  
 entry  :  
 loop   : loop 
 if     : loop 
 then   : endif 
 else   : endif 
 endif  : loop 
 exit   :  
 RETURN :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY  &lt;- [ROOT] : ENTRY 
 entry  &lt;- ENTRY  : ENTRY, entry 
 loop   &lt;- entry  : ENTRY, entry, loop 
 if     &lt;- loop   : ENTRY, entry, if, loop 
 then   &lt;- if     : ENTRY, entry, if, loop, then 
 else   &lt;- if     : ENTRY, else, entry, if, loop 
 endif  &lt;- if     : ENTRY, endif, entry, if, loop 
 exit   &lt;- loop   : ENTRY, entry, exit, loop 
 RETURN &lt;- exit   : ENTRY, entry, exit, loop, RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 .entry: 
   jmp  .loop; 
 .loop: 
   br cond .if .exit; 
 .if: 
   br cond .then .else; 
 .then: 
   jmp  .endif; 
 .else: 
   jmp  .endif; 
 .endif: 
   jmp  .loop; 
 .exit: 
   ret ; 
 .RETURN: </code></pre>
</details>
<ol start="2" type="1">
<li><strong>Loop Structures</strong>:
<ul>
<li><strong>Natural Loops</strong>: The algorithm successfully handles back edges and identifies the loop entry points as dominators for the loop body.</li>
<li><strong>Cross Loops and Multiple Entry Points</strong>: The implementation accurately distinguishes between blocks that dominate each shared section, even when the control flow is complex.</li>
<li><strong>Self-Loops</strong>: Dominance analysis treats the block as dominating itself, which is correctly identified in the results. <img src="./2024-10-11-Qucheng-HW4.image-2.png" class="img-fluid" alt="image"></li>
</ul></li>
</ol>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_dom/Cycle-with-Header-One-Entry-Point.golden-log#L1-L36">Cycle-with-Header-One-Entry-Point.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  Cycle-with-Header-One-Entry-Point.bril &lt;1 func&gt; @ example/in_class_example_dom 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;12 instr&gt; ================ 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY  :  
 entry  :  
 H1     : H1 
 A      : H1 
 H2     : H1, H2 
 B      : H1, H2 
 exit   :  
 RETURN :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY  &lt;- [ROOT] : ENTRY 
 entry  &lt;- ENTRY  : ENTRY, entry 
 H1     &lt;- entry  : ENTRY, H1, entry 
 A      &lt;- H1     : ENTRY, A, H1, entry 
 H2     &lt;- A      : ENTRY, A, H1, H2, entry 
 B      &lt;- H2     : ENTRY, A, B, H1, H2, entry 
 exit   &lt;- H1     : ENTRY, H1, entry, exit 
 RETURN &lt;- exit   : ENTRY, H1, entry, exit, RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 .entry: 
   jmp  .H1; 
 .H1: 
   br if_cond .A .exit; 
 .A: 
   jmp  .H2; 
 .H2: 
   br cond .B .H1; 
 .B: 
   br cond .H2 .H1; 
 .exit: 
   ret ; 
 .RETURN: </code></pre>
</details>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_dom/Cycle-without-Header-Two-Entry-Points.golden-log#L1-L28">Cycle-without-Header-Two-Entry-Points.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  Cycle-without-Header-Two-Entry-Points.bril &lt;1 func&gt; @ example/in_class_example_dom 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;8 instr&gt; ================= 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY  :  
 entry  :  
 if     :  
 loop2  : loop1 
 loop1  : loop2 
 RETURN :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY  &lt;- [ROOT] : ENTRY 
 entry  &lt;- ENTRY  : ENTRY, entry 
 if     &lt;- entry  : ENTRY, entry, if 
 loop2  &lt;- if     : ENTRY, entry, if, loop2 
 loop1  &lt;- if     : ENTRY, entry, if, loop1 
 RETURN &lt;- [ROOT] : RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 .entry: 
   jmp  .if; 
 .if: 
   br cond .loop1 .loop2; 
 .loop2: 
   jmp  .loop1; 
 .loop1: 
   jmp  .loop2; 
 .RETURN: </code></pre>
</details>
<ol start="3" type="1">
<li><strong>Complex Branches and Fallthrough Cases</strong>:
<ul>
<li>For cases with multiple branches and fallthrough behavior, the dominance frontier calculation correctly identifies the regions where the execution paths merge.</li>
<li>This indicates that the implementation can handle cases where control flow does not follow a simple pattern, such as switch statements with fallthrough. <img src="./2024-10-11-Qucheng-HW4.image-3.png" class="img-fluid" alt="image"></li>
</ul></li>
</ol>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_dom/Branch-Another-Example.golden-log#L1-L32">Branch-Another-Example.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  Branch-Another-Example.bril &lt;1 func&gt; @ example/in_class_example_dom 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;10 instr&gt; ================ 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY  :  
 n1     :  
 n2     : n2 
 n3     : n5 
 n4     : n5 
 n5     : n2 
 RETURN :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY  &lt;- [ROOT] : ENTRY 
 n1     &lt;- ENTRY  : ENTRY, n1 
 n2     &lt;- n1     : ENTRY, n1, n2 
 n3     &lt;- n2     : ENTRY, n1, n2, n3 
 n4     &lt;- n2     : ENTRY, n1, n2, n4 
 n5     &lt;- n2     : ENTRY, n1, n2, n5 
 RETURN &lt;- [ROOT] : RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 .n1: 
   jmp  .n2; 
 .n2: 
   br cond1 .n3 .n4; 
 .n3: 
   jmp  .n5; 
 .n4: 
   jmp  .n5; 
 .n5: 
   jmp  .n2; 
 .RETURN: </code></pre>
</details>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_dom/Branch-Complex-Example.golden-log#L1-L48">Branch-Complex-Example.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  Branch-Complex-Example.bril &lt;1 func&gt; @ example/in_class_example_dom 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;18 instr&gt; ================ 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY  :  
 n0     :  
 n5     : n4, n8 
 n1     : n4, n8 
 n7     : n8 
 n6     : n4 
 n2     : n4 
 n4     : n8 
 n3     : n8 
 n8     :  
 RETURN :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY  &lt;- [ROOT] : ENTRY 
 n0     &lt;- ENTRY  : ENTRY, n0 
 n5     &lt;- n0     : ENTRY, n0, n5 
 n1     &lt;- n0     : ENTRY, n0, n1 
 n7     &lt;- n5     : ENTRY, n0, n5, n7 
 n6     &lt;- n5     : ENTRY, n0, n5, n6 
 n2     &lt;- n1     : ENTRY, n0, n1, n2 
 n4     &lt;- n0     : ENTRY, n0, n4 
 n3     &lt;- n1     : ENTRY, n0, n1, n3 
 n8     &lt;- n0     : ENTRY, n0, n8 
 RETURN &lt;- n8     : ENTRY, n0, n8, RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 .n0: 
   br cond1 .n5 .n1; 
 .n5: 
   br cond2 .n7 .n6; 
 .n1: 
   br cond3 .n2 .n3; 
 .n7: 
   jmp  .n8; 
 .n6: 
   jmp  .n4; 
 .n2: 
   jmp  .n4; 
 .n4: 
   jmp  .n8; 
 .n3: 
   jmp  .n8; 
 .n8: 
   ret ; 
 .RETURN: </code></pre>
</details>
<ol start="4" type="1">
<li><strong>Other Edge Cases</strong>:
<ul>
<li>Tests involving cycles without a clear header, and cases with two or more entry points, show that the analysis correctly computes dominators based on the actual paths from any entry to each block.</li>
<li>The results reveal that the dominance utilities can generalize beyond typical loop constructs, making them suitable for analyzing diverse control flow patterns.</li>
</ul></li>
<li><strong>Other Real Benchmarks</strong>: <img src="./2024-10-11-Qucheng-HW4.image-4.png" class="img-fluid" alt="image"></li>
</ol>
<details>
<summary>
ℹ️ View log : <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/blob/16fcb6796f098b2512a380d5c717b4d431890cbf/HW4/example/in_class_example_df/in_class_example_1.golden-log#L1-L84">in_class_example_1.golden-log @ 16fcb67</a>.
</summary>
<pre class="log"><code> BrilScript ::  in_class_example_1.bril &lt;2 func&gt; @ example/in_class_example_df 
  
 ==== BrilFunction ::  in_class_example_1 ( input&lt;int&gt; ) -&gt; None: &lt;33 instr&gt; ==== 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY             :  
 _ffb1._anon0      :  
 assign_input_to_x :  
 is_x_gt_1         : is_x_gt_1 
 loop_start        : is_x_gt_1 
 is_y_gt_3         : is_x_gt_1 
 y_gt_3            : loop_cont1 
 loop_cont1        : is_x_gt_1 
 is_z_gt_0         : is_x_gt_1 
 z_gt_0            : loop_cont2 
 loop_cont2        : is_x_gt_1 
 print_output      :  
 RETURN            :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY             &lt;- [ROOT]            : ENTRY 
 _ffb1._anon0      &lt;- ENTRY             : ENTRY, _ffb1._anon0 
 assign_input_to_x &lt;- _ffb1._anon0      : ENTRY, _ffb1._anon0, assign_input_to_x 
 is_x_gt_1         &lt;- assign_input_to_x : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1 
 loop_start        &lt;- is_x_gt_1         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, loop_start 
 is_y_gt_3         &lt;- loop_start        : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, loop_start 
 y_gt_3            &lt;- is_y_gt_3         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, loop_start, y_gt_3 
 loop_cont1        &lt;- is_y_gt_3         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, loop_cont1, loop_start 
 is_z_gt_0         &lt;- loop_cont1        : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, is_z_gt_0, loop_cont1, loop_start 
 z_gt_0            &lt;- is_z_gt_0         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, is_z_gt_0, loop_cont1, loop_start, z_gt_0 
 loop_cont2        &lt;- is_z_gt_0         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, is_y_gt_3, is_z_gt_0, loop_cont1, loop_cont2, loop_start 
 print_output      &lt;- is_x_gt_1         : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, print_output 
 RETURN            &lt;- print_output      : ENTRY, _ffb1._anon0, assign_input_to_x, is_x_gt_1, print_output, RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 ._ffb1._anon0: 
   zero: int = const 0; 
   one: int = const 1; 
   two: int = const 2; 
   three: int = const 3; 
   four: int = const 4; 
   x: int = const 0; 
   y: int = const 0; 
   z: int = const 0; 
 .assign_input_to_x: 
   x: int = id input; 
 .is_x_gt_1: 
   cond1: bool = gt x one; 
   br cond1 .loop_start .print_output; 
 .loop_start: 
   y: int = div x two; 
 .is_y_gt_3: 
   cond2: bool = gt y three; 
   br cond2 .y_gt_3 .loop_cont1; 
 .y_gt_3: 
   x: int = sub x y; 
 .loop_cont1: 
   z: int = sub x four; 
 .is_z_gt_0: 
   cond3: bool = gt z zero; 
   br cond3 .z_gt_0 .loop_cont2; 
 .z_gt_0: 
   x: int = div x two; 
 .loop_cont2: 
   z: int = sub z one; 
   jmp  .is_x_gt_1; 
 .print_output: 
   print x; 
   ret ; 
 .RETURN: 
  
 ================ BrilFunction ::  main (  ) -&gt; None: &lt;2 instr&gt; ================= 
 ---------------------------------- Dom-Front ----------------------------------- 
 ENTRY        :  
 _f0d6._anon0 :  
 RETURN       :  
 -------------------------------- Dom &amp; Dom-Tree -------------------------------- 
 ENTRY        &lt;- [ROOT]       : ENTRY 
 _f0d6._anon0 &lt;- ENTRY        : ENTRY, _f0d6._anon0 
 RETURN       &lt;- _f0d6._anon0 : ENTRY, _f0d6._anon0, RETURN 
 ------------------------------------ Script ------------------------------------ 
 .ENTRY: 
 ._f0d6._anon0: 
   input: int = const 10; 
   call in_class_example_1; 
 .RETURN: </code></pre>
</details>
<p><em>* Check <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/tree/main/HW4/output">HERE</a> to see all graphical test case results.</em> <em>** Check <a href="https://github.com/jiangqucheng/EECE7398_ST_Compiler/tree/main/HW4/example">HERE</a> to see all golden snapshots.</em></p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Dominance analysis is a key part of CFG-based optimizations in compilers. It involves: - Identifying dominators to understand the flow of control. - Using the immediate dominator to build the dominator tree. - Computing the dominance frontier to manage variable merging.</p>
<p>These concepts enable powerful optimizations and transformations that improve program efficiency and correctness. In the following sections, we will explore how to implement dominance analysis in a compiler framework, test the correctness of the results, and apply these concepts to optimize real programs.</p>
<p>The integration and testing of the dominance analysis show that the implementation is reliable and performs well across a range of control flow scenarios. By comparing the analysis results with known references and carefully designed test cases, we ensure the correctness of the dominator tree construction and dominance frontier calculations.</p>
<p>The next steps involve using this verified dominance analysis for further compiler optimizations, such as SSA form conversion, dead code elimination, and loop-invariant code motion, leveraging the dominance relationships identified in this phase.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/normrubin\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW3.html" class="pagination-link" aria-label="Homework 3: Data Flow">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Homework 3: Data Flow</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../blogs/Qucheng/2024-10-11-Qucheng-HW5.html" class="pagination-link" aria-label="Homework 5: LLVM - Spinning Up">
        <span class="nav-page-text">Homework 5: LLVM - Spinning Up</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://normrubin.github.io/">EECS 7398 website</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/normrubin/normrubin.github.io/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>